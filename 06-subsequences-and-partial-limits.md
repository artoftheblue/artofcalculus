# Подпоследовательности и частичные пределы

(almost_all)=
Мы будем часто употреблять фразу **почти все**, которая означает все за исключением конечного числа. Например, неравенство в натуральных числах $n\ge 10$ верно для почти всех натуральных $n$. То есть оно неверно, если $n=1,2,\ldots,9$, но **для всех остальных оно верно.**

## Понятие подпоследовательности

:::{prf:definition}
:label: subsequence
Пусть задана числовая последовательность $(a_n)$
и задана последовательность строго возрастающих её номеров $n_1 <n_2< n_3 < \ldots$, тогда последовательность $\{a_{n_k}\}:= \{a_{n_1}, a_{n_2}, a_{n_3},\ldots,\}$ называется **подпоследовательностью** последовательности $(a_n).$
:::

:::{prf:example}
Очень важно понимать, что выбранные номера должны строго возрастать.

1. Рассмотрим последовательность $(a_n)=\{1,2,3,1,2,3,\ldots,\}$, тогда если положить, что $n_k = 2k$ для всех $k\ge 1$, то мы получаем подпоследовательность $a_{n_k} = \{2,1,3,2,1,3, \ldots,\}$. Но если мы выберем номера так, чтобы $n_1= 2, n_2 = 1, n_3=1, \ldots,$ то мы получим последовательность $2,1,3,\ldots,$ которая уже подпоследовательностью не является, так как $n_1 = 2 <n_2 = 1.$

2. Пусть $(a_n) = \{1,1,1,5,5,5,5,\ldots,\}.$ Тогда $\{5,5,1,\ldots,\}$ не будет подпоследовательностью, потому что $n_1 \ge 4$, в то время как $n_3 \le 3$, **т. е.** $n_1 >n_3$. 

:::

:::{warning}
Можно сказать, что любая последовательность есть ``сплетение'' подпоследовательностей; они как множества могут пересекаться, а могут и нет, но в объединении мы получаем всю нашу изначальную последовательность.
:::

:::{prf:lemma}
:name: n_kgeqk
Пусть $\{n_k\}$ — строго возрастающая последовательность натуральных чисел, тогда $n_k \ge k$ для каждого $k\ge 1.$
:::
:::{prf:proof}
:class: dropdown
:nonumber:
Будем доказывать по индукции. Так как это последовательность натуральных чисел, то каждое $n_t\ge 1$, в частности $n_1\ge 1$. Пусть теперь верно неравенство $n_t \ge t$ для $t\ge 1$. Так как последовательность является строго возрастающей, то $n_{t+1}>n_t \ge t$, **т. е.** $n_{t+1} >t$ или что есть то же самое, что и $n_{t+1}\ge t+1$.
:::

:::{prf:theorem}
:name: lim(sub)=lim
Пусть дана последовательность $(a_n)$ такая, что $\lim_{n\to \infty}a_n = a$, тогда $\lim_{n\to \infty}a_{n_k} =a$ для любой подпоследовательности $\{a_{n_k}\}$.
:::
:::{prf:proof}
:class: dropdown
:nonumber:
Рассмотрим произвольную подпоследовательность $\{a_{n_k}\}$. Так как $\lim_{n \to \infty}a_n =a$, то для любого $\varepsilon >0$ можно найти такой номер $N$, что $|a_n - a| < \varepsilon$ для всех $n >N$. Тогда выберем такой номер $k$, что $k >N$. По Лемме [](#n_kgeqk), $n_k \ge k$, тогда для всех $n_t \ge n_k >N$, $|a_{n_t}- a| < \varepsilon$, что и доказывает теорему.
:::

:::{prf:example}
Вспомним про последовательность $(a_n) = \{(-1)^n\} = \{-1,1,-1,1, \ldots, \}$. Нетрудно видеть, что подпоследовательности $\{a_{n_k}\} = \{-1\}$, $\{a_{n_t}\} = \{1\}$ с номерами $n_k = 2k+1$, $n_t = 2t$, $k,t \ge 1$ являются сходящимися подпоследовательностями. В то же время, сама последовательность предела не имеет (Пример [](#-1n)), хотя эта последовательность ограничена. Оказывается, имеет место следующий факт: 
:::

:::{prf:theorem} Больцано-Вейерштрасса
:name: B-W
Если $(x_n)$ есть ограниченная последовательность, то в ней есть сходящаяся подпоследовательность.
:::
:::{prf:proof}
:class: dropdown
:nonumber:

(1) Так как наша последовательность ограничена, скажем, $a \le x_n \le b$, то это значит, что всё её элементы лежат в отрезке $I_1 = [a,b]$.

(2) Разделим этот отрезок на две равные части и выберем ту половину, назовём её $I_2$, в которой находятся почти все элементы этой последовательности (**т. е.** бесконечное число её элементов). Если в обеих половинах находятся почти все элементы, то выбираем любую из них.

(3) Ту же процедуру проведём для выбранной половины $I_2$ и так далее. В результате мы получаем систему отрезков $I_1, I_2, I_3, \ldots$, при этом их длины уменьшаются каждый раз в два раза, то есть $\lim_{n \to \infty}|I_n| = 0$. Более того, $I_1 \supseteq I_2 \supseteq I_3 \supseteq \cdots$, тогда по Лемме [](#cap_of_intervals) $\cap_{n=1}^\infty I_n \ni \{c\}.$

(4) Выберем теперь в каждом отрезке $I_k$ элемент нашей последовательности с номером $n_k$, при этом требуя, чтобы номер $n_{k+1}$ элемента, выбранного из следующего отрезка $I_{k+1}$, был строго больше предыдущего, **т. е.** $n_k<n_{k+1}$. Это можно сделать, потому что в каждом из отрезков $I_k$ имеется бесконечное число элементов нашей последовательности. Но это и означает, что для любого номера можно всегда найти такой элемент, номер которого будет заведомо больше выбранного.

(5) Тогда по построению мы получили для любого $n_k$, $|x_{n_k}-c| < |I_k| = \frac{I_1}{2^{k}}$. Но это и означает, что $\lim_{n_k \to \infty}a_{n_k} = c.$
:::

Как показывает пример с последовательностью $(a_n) = \{(-1)^n\}$, у последовательности могут быть подпоследовательности, у которых имеются разные пределы. Поэтому возникает вопрос, а какие пределы у всех подпоследовательностей могут быть?

:::{prf:definition}
:label: partial-limit
Предел какой-то подпоследовательности в последовательности $(a_n)$ называется **частичным пределом** последовательности $(a_n)$.
:::

Наша цель — описать все частичные пределы. Полностью эта задача будет решена, когда мы познакомимся с топологией вещественной прямой.

Начнём с примера.

:::{prf:example}
Рассмотрим последовательность $(x_n)$, где $x_n = (-1)^{n-1}\left(2 + \frac{3}{n} \right)$. Её первые десять элементов имеют вид

| $n$ | 1 | 2 | 3 | 4  | 5 | 6 | 7 | 8  | 9 | 10 |
|-------|---|------|---|-------|-----|------|------|-------|-----|-------|
| $x_n$ | 5 | -3.5 | 3 | -2.75 | 2.6 | -2.5 | 2.42 | -2.37 | 2.3 | -2.27 |


Мы видим, что $(x_n) = (x_{2n-1}) \sqcup (x_{2n})$, $x_{2n-1} = 2 + \frac{3}{2n-1}$, $x_{2n} = - 2- \frac{3}{2n}$. Тогда очевидно, что $x_{2p-1} > x_{2q}$ для любых $p,q \ge 1$, т. е. графически это означает, что $\{x_{2n-1}\}$ расположена выше оси $Ox$, а $(x_{2n})$ — ниже оси $Ox$. Нетрудно видеть, что $\lim_{n \to \infty} x_{2n-1} = 2$, $\lim_{n \to \infty} x_{2n} = -2$.

Далее очевидно, что $x_{2n-1}$ убывает, а последовательность $x_{2n}$ возрастает. Тогда $x_{2n-1} > x_{2n}$, следовательно $\lim \sup x_n = \lim \sup x_{2n-1} = 2$, $\lim \inf = \lim \inf x_{2n} = -2.$ 

:::

:::{prf:example}
Пусть $(a_n) = \{1,2,3,1,2,3,1,2,3,\ldots,\}$. Найдём все её частичные пределы. Пусть $b \ne 1,2,3$, и $b$ — это какой-то частичный предел. Это значит, что найдётся бесконечное число номеров $n_k$ (которые и сформируют подпоследовательность) такие, что $|a_{n_k} - b| < \varepsilon$ для любого $\varepsilon >0$. Но взяв $\varepsilon = \frac{1}{2}$, мы видим, что неравенства $|1-b|, |2-b|, |3-b| < \frac{1}{2}$ при $b \ne 1,2,3$ не верны. С другой же стороны, если $b \in \{1,2,3\}$, то хотя бы одно из них верно для любого $\varepsilon>0$. 

Это значит, что множество всех частичных пределов есть множество $\{1,2,3\}$, при этом $1<2<3.$ 
:::

:::{prf:example}
Пусть $(a_n') = \{-12, 15, 999, -\pi, \sqrt{2}, 1,2,3,1,2,3,1,2,3,\ldots,\}.$ Нетрудно видеть, что множество частичных пределов у этой последовательности ровно такое же, что и в предыдущем примере. Причина этого ясна: наличие конечного числа первых элементов не влияет на сам предел (так как в окрестности предела должно быть бесконечное число элементов последовательности!).
:::

## Частичные пределы

:::{prf:theorem}
:name: from_bounded_sequence
Пусть $(a_n)$ — ограниченная последовательность, тогда

1. Последовательность $M_k:=\sup_{n>k}(a_n)$;

| | | |
|----------|------|----------------------------------------|
| $M_1$ | $:=$ | $ \sup \{a_2, a_3, a_4,a_5 \ldots,\},$ |
| $M_2$ | $:=$ | $ \sup \{ a_3, a_4,a_5 \ldots,\},$ |
| $M_3$ | $:=$ | $ \sup \{ a_4, a_5 \ldots,\},$   |
| $M_4$ | $:=$ | $ \sup \{a_5, \ldots,\},$    |
| $\vdots$ |  | $\vdots$         |

не возрастает, ограничена и имеет предел, который называется **верхним пределом последовательности** и обозначается $\lim \sup a_n$.

2. Последовательность $m_k:=\inf_{n>k}(a_n)$;

| | | |
|----------|------|----------------------------------------|
| $m_1$ | $:=$ | $ \inf \{a_2, a_3, a_4,a_5, \ldots,\},$ |
| $m_2$ | $:=$ | $ \inf \{a_3, a_4, a_5,\ldots,\},$  |
| $m_3$ | $:=$ | $ \inf \{a_4,a_5 \ldots,\},$   |
| $m_4$ | $:=$ | $ \inf \{a_5, \ldots,\},$    |
| $\vdots$ |  | $\vdots$         |

не убывает, ограничена и имеет предел, который называется **нижним пределом последовательности** и обозначается $\lim \inf a_n$.

3. Для любой подпоследовательности $(b_n) \subseteq (a_n)$, 
$$
\lim \inf a_n \le \lim_{n \to \infty } b_n \le \lim \sup a_n.
$$


:::

Прежде чем доказать эту теорему, докажем следующую лемму:

:::{prf:lemma}
:name: AleB=sup(A)lesup(B)
Пусть $A \subseteq B \subseteq \mathbb{R}$ — два ограниченных подмножества в $\mathbb{R}$, тогда $\sup(A) \le \sup(B)$ (если $B$ ограничено сверху) и $\inf(A) \ge \inf(B)$ (если $B$ ограничено снизу). 
:::
:::{prf:proof}
:class: dropdown
:nonumber:
Во-первых, заметим, что существование точной грани в зависимости от характера ограниченности обеспечивается принципом полноты Вейерштрасса (Теорема [](#W=complete)). 

Далее, если $\sup(B) = b$, то для любых $x \in B$ имеем $x \le b$, так как $A \subseteq B$, то и $x \le b$ для любого $x \in A$, что и доказывает требуемое. Аналогично доказывается и для $\inf$, где нужно учесть, что $\inf(A) = -\sup (-A)$.
:::

:::{prf:proof} Доказательство теоремы
:class: dropdown
:nonumber:
Имеем $M_n : = \sup\{a_{n+1}, \ldots, \}$, $M_{n+1}:=\sup \{a_{n+2}, \ldots,\}$ и так как
$$
\{a_n, a_{n+1}, \ldots, \} \supseteq \{a_{n+1}, a_{n+2} \ldots, \},
$$
то по [](#AleB=sup(A)lesup(B)) $M_n \ge M_{n+1}$, т. е. последовательность $(M_n)$ не возрастает и также $m_n \le m_{n+1}$, т. е. последовательность $\{m_n\}$ не убывает.

Далее, так как последовательность $(a_n)$ ограничена, значит, и $(M_n)$, $(m_n)$ —- ограничены. Тогда по теореме Вейерштрасса у них есть пределы.

Теперь мы должны показать, что эти пределы являются частичными пределами для нашей последовательности. Другими словами, мы должны предъявить такие подпоследовательности $\{a_{n_k}\} \subseteq (a_n)$, $\{a_{n_r}\} \subseteq (a_n)$, что $\lim_{n_k \to \infty} a_{n_k} =M$, $\lim_{n_r \to \infty} a_{n_r} =m$.

Мы это проделаем только для первого случая, так как второй аналогичный.

Так как $M_1 = \sup \{a_2, a_3, a_4,a_5 \ldots,\}$, то найдётся хотя бы один элемент $a_{n_1} \in \{a_2, a_3, a_4,a_5 \ldots,\}$ такой, что $M_1 -1< a_{n_1} \le M_1$. Такой элемент найдётся, потому что $M_1 -1 \ne \sup \{a_2, a_3, a_4,a_5 \ldots,\}.$

Продолжим теперь следующим образом: рассмотрим $M_{n_1}$, по определению
$$
M_{n_1}: = \sup \{a_{n_1 +1}, a_{n_1+2}, a_{n_1+3},\ldots,\},
$$
найдётся хотя бы один $a_{n_2} \in \{a_{n_1 +1}, a_{n_1+2}, a_{n_1+3},\ldots,\}$ такой, что $M_{n_1} - \frac{1}{2} < a_{n_2} \le M_{n_1}$, при этом очевидно, что $n_2>n_1.$

Продолжая по индукции, мы получаем следующее: если для $n_k$ мы нашли $a_{n_k}$ такой, что $M_{n_{k-1}} - \frac{1}{k} < a_{n_{k}} \le M_{n_{k-1}}$, при этом $n_{k}>n_{k-1}> \cdots > n_1$, то мы получили подпоследовательность $\{a_{n_k}\}.$

Ясно, что $\{M_{n_k}\}$ есть подпоследовательность последовательности $\{M_n\}$, но мы уже знаем, что $\lim_{n\to \infty}M_n = M$, тогда по теореме [](#lim(sub)=lim), $\lim_{n_k\to \infty}M_{n_k} = M$. Наконец, по лемме о зажатой последовательности (Лемма [](#squeezy) получаем, что $\lim_{n_k \to \infty}a_{n_k} = M.$

Таким образом, мы построили подпоследовательность $\{a_{n_k}\}$, у которой предел равен $M$, что и доказывает, что $M$ — это частичный предел последовательности $(a_n).$

Наконец, покажем, что любой частичный предел лежит в отрезке $[m,M].$ Возьмём произвольную подпоследовательность $\{a_{n_t}\}$, и пусть $\lim_{n_t \to \infty}a_{n_{t}} = a$. По определению чисел $m_t, M_t$ имеем: $m_{n_{t}-1} \le a_{n_t} \le M_{n_t-1}$. Тогда учитывая, что $\lim_{n_t \to \infty} m_{n_t} = m$, $\lim_{n_t \to \infty}M_{n_t} = M$ и Лемму [](#aleb), получаем $m\le a \le M$. Это завершает доказательство теоремы.
:::