# Частные производные и явная формула для дифференциала

Рассмотрим теперь функцию $f:\mathbb{R}^n \to \mathbb{R}$, дифференцируемую на каком-то открытом $\mathscr{U} \subseteq \mathbb{R}^n$ или в фиксированной точке $\m{x}$. Тогда её дифференциал $(\mathrm{d}f)_\m{x}$ в точке $\m{x}$ задаётся матрицей размера $n\times 1$, $(\mathrm{d}f)_\m{x} = \begin{pmatrix}
a_1 & \ldots & a_n
\end{pmatrix}$, где все $a_i$ есть функции от $\m{x}$. Наша цель — найти эти $a_i$. Пусть $\m{h} = (h_1, \ldots, h_n)^\top \in \mathbb{R}^n$, тогда получаем
$$\begin{eqnarray}
f(\m{x} + \m{h}) - f(\m{x}) &=& (\mathrm{d}f)_\m{x}(\m{h}) + o(||\m{h}||) \\
&=& \begin{pmatrix}
a_1 & \ldots & a_n
\end{pmatrix} \begin{pmatrix}
h_1 \\ \vdots \\ h_n  \end{pmatrix} + o(||\m{h}||) \\
&=& a_1h_1 + \cdots + a_nh_n + o(||\m{h}||).
\end{eqnarray}$$

Видно, что $a_i$ не зависит от координат вектора $\m{h}$ кроме $h_i$ т. е. чтобы найти $a_i$, нам достаточно рассмотреть вектор $\m{h}_i = h_i \m{e}_i$, где $\m{e}_i$ — базисный вектор. В таком случае, $||\m{h}_i|| = |h_i|$ и тогда для каждого $1 \le i \le n$ мы получаем
$$
f(\m{x} + h_i \m{e}_i) - f(\m{x}) = a_ih_i + o(|h_i|),
$$
таким образом, 
$$
a_i = \lim_{h_i \to 0} \frac{f(\m{x} + h_i \m{e}_i) - f(\m{x})}{h_i},
$$
такое выражение называется **частной производной функции по переменной $x_i$** и обозначается либо как $\frac{\partial f}{\partial x_i}$, либо как $f'_{x_i}$, т. е. 
\begin{equation}\label{partial_i}
\boxed{
\frac{\partial f}{\partial x_i}: = \lim_{h_i \to 0} \frac{f(\m{x} + h_i \m{e}_i) - f(\m{x})}{h_i}}    
\end{equation}
если же мы хотим знать её значение в точке $\m{x}_0$, то получаем
\begin{equation}\label{partial_i(o)}
\boxed{
\frac{\partial f}{\partial x_i}(\m{x}_0): = \lim_{h_i \to 0} \frac{f(\m{x}_0 + h_i \m{e}_i) - f(\m{x}_0)}{h_i}.
}
\end{equation}

Таким образом, в случае функции $f:\mathbb{R}^n \to \mathbb{R}$ дифференциал в точке $\m{x}_0$ находится по формуле
$$
(\mathrm{d}f)_{\m{x}_0}: = \begin{pmatrix}
\frac{\partial f}{\partial x_1}(\m{x}_0) & \ldots & \frac{\partial f}{\partial x_n}(\m{x}_0)
\end{pmatrix}.
$$

Тогда для любого вектора $\m{h} = (h_1,\ldots, h_n)^\top$,
$$
(\mathrm{d}f)_{\m{x}_0}(\m{h}) =  \begin{pmatrix}
\frac{\partial f}{\partial x_1}(\m{x}_0) & \ldots & \frac{\partial f}{\partial x_n}(\m{x}_0)
\end{pmatrix} \begin{pmatrix}
h_1 \\ \vdots \\ h_n
\end{pmatrix} = ((\mathrm{d}f)_{\m{x}_0}, \m{h}),
$$
где последняя скобка означает скалярное произведение.

:::{prf:definition}
Дифференциал $(\mathrm{d}f)_{\m{x}_0}$ функции $f: \mathbb{R}^n \to \mathbb{R}$ в точке $\m{x}_0$ называется **градиентом** функции. Принято обозначение $\nabla_{\m{x}_0}f$ для градиента.
:::

:::{warning}
Мы видим, что дифференциал функции $f:\mathbb{R}^n \to \mathbb{R}$ похож на вектор, но вовсе не есть вектор, так как он определён на векторах и принимает от них числовые значения. Другими словами, это элемент двойственного векторного пространства $V^*: = \mathrm{Hom}(V, \mathbb{R})$ к векторному пространству $V$. Элементы из $V^*$ называются **функционалами** или **ковекторами**.    
:::


## Геометрический смысл частных производных

Итак, мы уже поняли, что если $f:\mathbb{R} \to \mathbb{R}$ — дифференцируемая функция в точке $x_0$, то значение её производной в точке $x_0$ можно понимать как наклон касательной к графику этой функции в точке $(x_0, f(x_0))$. Пусть теперь $f:\mathbb{R}^n \to \mathbb{R}$ — функция от $n>1$ переменных, и пусть она дифференцируема в точке $\m{x}_0$. Тогда возникает вопрос, о чём говорят значения её частных производных в точке $\m{x}_0$?

Для наглядности мы ограничимся случаем, когда $n=2$, случай, когда $n >2$, совершенно аналогичен.

Итак, пусть у нас есть функция $f:\mathbb{R}^2 \to \mathbb{R}$, которая дифференцируема в точке $(x_0,y_0)$. Рассечём её график плоскостью, параллельной плоскости $yz$, через точку $(x_0,y_0,0)$. Тогда мы получаем кривую, которая представляется какой-то функцией от $y$. Тогда, согласно определению частой производной, мы видим, что наклон к графику этой функции и есть значение $\frac{\partial f}{\partial y}(x_0,y_0)$.

```{figure} ./images/partial_deri.jpg
Мы рассекли график $z =f(x,y)$ плоскостью, параллельной плоскости $yz$, через точку $(x_0,y_0,0)$. Тогда мы получаем кривую, которая представляется какой-то функцией от $y$, и её наклон и есть $\frac{\partial f}{\partial y}(x_0,y_0)$.
```

С другой стороны, мы можем пойти дальше и рассечь этот же график, но уже не параллельной ни плоскости $yz$, ни плоскости $xz$. Как тогда вычислить наклон?

```{figure} ./images/direction_der.jpg
Мы рассекли график плоскостью, но уже не параллельной ни плоскости $yz$, ни плоскости $xz$.
```

Чтобы ответить на этот вопрос, мы рассмотрим множество всех прямых, которые касаются графика в точке $(x_0, y_0, f(x_0,y_0))$. Такое множество мы называем **касательной плоскостью** к графику $z = f(x,y).$

```{figure} ./images/direction_der2.jpg

```

Уравнение плоскости, которая проходит через точку $(0,0,0)$, имеет вид $z = Ax + By$. Тогда сдвинув эту плоскость к точке $(x_0, y_0, f(x_0,y_0))$, мы получим тогда такое уравнение плоскости: $z - f(x_0,y_0) = A(x-x_0) + B(y-y_0)$. Осталось найти коэффициенты $A,B$, чтобы эта плоскость стала касательной. Пересечём эту плоскость с плоскостью $y=y_0$, в результате мы получаем прямую $z(x, y_0) - f(x_0,y_0) = A(x-x_0)$, тогда потребовав, чтобы эта прямая была касательной, мы получаем, что $A = \frac{\partial f}{\partial x}(x_0,y_0)$. Аналогично находим $B = \frac{\partial f}{\partial y}(x_0,y_0)$.

Итак, уравнение плоскости имеет вид
$$
z - f(x_0,y_0) = \left.\frac{\partial f}{\partial x}\right|_{(x_0,y_0)} (x-x_0) + \left.\frac{\partial f}{\partial y}\right|_{(x_0,y_0)} (y-y_0)
$$

Вернёмся ещё раз к предыдущему рисунку. Введём обозначения. Пусть $P$ — вертикальная плоскость, проходящая через точку $(x_0,y_0)$. Пусть $\ell$ — прямая, по которой $P$ пересекает плоскость $xy$. Касательную прямую к кривой, которую высекает плоскость $P$, мы обозначим через $L$. Касательная плоскость в точке $(x_0,y_0, f(x_0,y_0))$ пусть будет $T$. Далее, рассмотрим вектор $\m{v}$, который лежит на $\ell$, выходит из точки $(x_0,y_0)$ и кончается в $(x_0+a, y_0 +b)$, т. е. имеет координаты $(a,b)$.

Имеем
$$\begin{eqnarray}
T(x_0 + a, y_0 + b) - T(x_0,y_0) &=& \left.\frac{\partial f}{\partial x}\right|_{(x_0,y_0)} (x_0 +a-x_0) + \left.\frac{\partial f}{\partial y}\right|_{(x_0,y_0)} (y_0 +b-y_0) \\
&=& a\left.\frac{\partial f}{\partial x}\right|_{(x_0,y_0)} + b\left.\frac{\partial f}{\partial y}\right|_{(x_0,y_0)} \\
&=& \langle \m{v} , \nabla f (x_0, y_0) \rangle
\end{eqnarray}$$

Тогда, чтобы вычислить наклон, нужно потребовать, чтобы один из катетов в прямоугольном треугольнике был равен $1$, таким образом, если $a^2 + b^2 = 1$, то искомый наклон и есть число $\langle \m{v} , \nabla f (x_0, y_0) \rangle.$

:::{prf:definition}
Пусть $\gamma: (-c,c) \to \mathbb{R}^n$ — кривая в $\mathbb{R}$, т. е. отображение непрерывно. Пусть $\gamma(0) = \m{x}_0$, и пусть $\gamma$ дифференцируема в точке $t = 0$, и $\dot\gamma(0) = \m{v}.$ Наконец, пусть $f:\mathbb{R}^n \to \mathbb{R}$ — дифференцируемая в точке $\m{x}_0$ функция, тогда число 
$$
\nabla_{\dot\gamma(0)}(f):= \dfrac{1}{||\dot\gamma(0)||}\langle \nabla f(\m{x}_0), \dot\gamma(0) \rangle
$$
называется **производной по направлению функции $f$ вдоль вектора $\dot \gamma(0)$.**
:::


Более просто производную по направлению можно определить следующим образом
:::{prf:definition}
Пусть дана точка $\m{p} \in \mathbb{R}^n$, вектор $\m{v}\in \mathbb{R}^n$ и пусть $f:\mathbb{R}^n \to \mathbb{R}$ — функция. Тогда **производная по направлению $\m{v}$, вычисленная в точке $\m{p}$** есть выражение вида
$$
(\nabla_\m{v}f)(\m{p}): = \frac{1}{\| \m{v}\|} (\mathrm{d}f)_\m{p} \m{v},
$$
:::
где справа стоит умножение матриц. А именно, так как
$$
(\mathrm{d}f)_\m{p} = \begin{pmatrix}
f'_{x_1}(\m{p}) & \ldots & f'_{x_n}(\m{p})
\end{pmatrix} \in \mathrm{Mat}_{1\times n}(\mathbb{R}),
$$
то получаем
$$
\boxed{
(\nabla_\m{v}f)(\m{p}) =\frac{1}{\|\m{v}\|} \left(  f'_{x_1}(\m{p})v_1 + \cdots + f'_{x_n}(\m{p}) v_n\right).
}
$$



Рассмотрим теперь отображение $F: \mathbb{R}^n \to \mathbb{R}^m$, которое задаётся следующим образом:

$$
F: \begin{pmatrix}
x_1 \\ \vdots \\ x_n
\end{pmatrix} \mapsto 
\begin{pmatrix}
f_1(x_1, \ldots, x_n) \\ \vdots \\ f_m(x_1, \ldots, x_n),
\end{pmatrix}
$$

где $f_i:\mathbb{R}^n \to \mathbb{R}$. Потребуем, чтобы $F$ была дифференцируема в каком-то открытом $\mathscr{U} \subseteq \mathbb{R}^n$ или в фиксированной точке $\m{x}_0$. 

Тогда 
$$
F(\m{x} + \m{h}) - F(\m{h}) = (\mathrm{d}_\m{x}F)(\m{h}) + o(||\m{h}||).
$$

Пусть $\m{h} = h_i \m{e}_i$, тогда $(\mathrm{d}_\m{x}F)(\m{e}_i)$ есть $i$-ый столбец матрицы $(\mathrm{d}_\m{x}F)(\m{h})$, и мы получаем равенство

$$
\begin{pmatrix}
f_1(x_1, \ldots, x_i + h_i, \ldots, x_n) -f_1(x_1, \ldots, x_i, \ldots, x_n) \\
\vdots \\
f_m(x_1, \ldots, x_i + h_i, \ldots, x_n) -f_m(x_1, \ldots, x_i, \ldots, x_n)
\end{pmatrix} = h_i(\mathrm{d}_\m{x}F)(\m{e}_i) + o(|h_i|), \qquad 1 \le i \le n
$$

тогда

$$
(\m{d}F)_\m{x}(\m{e}_i) = \begin{pmatrix}
\frac{\partial f_1}{\partial x_i} \\ \vdots \\ \frac{\partial f_m}{\partial x_i}
\end{pmatrix}
$$

и в итоге

$$
(\m{d}F)_\m{x} = \begin{pmatrix}
\frac{\partial f_1}{\partial x_1} & \ldots & \frac{\partial f_1}{\partial x_n} \\
\vdots & \ddots & \vdots \\
\frac{\partial f_m}{\partial x_1} & \ldots & \frac{\partial f_m}{\partial x_n}
\end{pmatrix}, \qquad 
(\m{d}F)_{\m{x}_0} = \begin{pmatrix}
\frac{\partial f_1}{\partial x_1}({\m{x}_0}) & \ldots & \frac{\partial f_1}{\partial x_n} ({\m{x}_0}) \\
\vdots & \ddots & \vdots \\
\frac{\partial f_m}{\partial x_1} ({\m{x}_0}) & \ldots & \frac{\partial f_m}{\partial x_n} ({\m{x}_0})
\end{pmatrix}
$$

Такая матрица называется **Якобианом** отображения $F.$
